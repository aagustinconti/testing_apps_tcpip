
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Proyecto final de la materia 'Aplicaciones TCP/IP' de la carrera de Ingeniería de Telecomunicaciones.">
      
      
        <meta name="author" content="Aguilera Conti Agustín y Príncipe Agustín">
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../3-conclusion/">
      
      
      <link rel="icon" href="../img/tech_ethernet_icon_156953.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>Desarrollo - Aplicaciones TCP/IP | Testing</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-ui" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Aplicaciones TCP/IP | Testing" class="md-header__button md-logo" aria-label="Aplicaciones TCP/IP | Testing" data-md-component="logo">
      
  <img src="../img/tech_ethernet_icon_156953.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Aplicaciones TCP/IP | Testing
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Desarrollo
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="lime"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aagustinconti/testing_apps_tcpip" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    aagustinconti/testing_apps_tcpip
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Pestañas" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Introducción

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Desarrollo

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../3-conclusion/" class="md-tabs__link">
        
  
    
  
  Conclusión

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../4-bibliography/" class="md-tabs__link">
        
  
    
  
  Bibliografía

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../5-attachments/" class="md-tabs__link">
        
  
    
  
  Anexo

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../propuesta/" class="md-tabs__link">
        
  
    
  
  Prupuesta

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Aplicaciones TCP/IP | Testing" class="md-nav__button md-logo" aria-label="Aplicaciones TCP/IP | Testing" data-md-component="logo">
      
  <img src="../img/tech_ethernet_icon_156953.ico" alt="logo">

    </a>
    Aplicaciones TCP/IP | Testing
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aagustinconti/testing_apps_tcpip" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    aagustinconti/testing_apps_tcpip
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Desarrollo
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Desarrollo
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#contexto" class="md-nav__link">
    <span class="md-ellipsis">
      Contexto
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#como-generar-el-ambiente-de-desarrollo-local" class="md-nav__link">
    <span class="md-ellipsis">
      Como generar el ambiente de desarrollo local
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura" class="md-nav__link">
    <span class="md-ellipsis">
      Estructura
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Estructura">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aclaracion-sobre-nextjs" class="md-nav__link">
    <span class="md-ellipsis">
      Aclaracion sobre NextJS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejemplos-y-pruebas" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos y pruebas
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-conclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conclusión
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-bibliography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bibliografía
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-attachments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anexo
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../propuesta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prupuesta
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset"><a class="md-content__button md-icon" download href="2-body.pdf" title="PDF Export"><svg style="height: 1.2rem; width: 1.2rem;" viewBox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm76.45 211.36l-96.42 95.7c-6.65 6.61-17.39 6.61-24.04 0l-96.42-95.7C73.42 337.29 80.54 320 94.82 320H160v-80c0-8.84 7.16-16 16-16h32c8.84 0 16 7.16 16 16v80h65.18c14.28 0 21.4 17.29 11.27 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"></path></svg></a>
                
                  

  
  


<h1 id="api-ui">API &amp; UI</h1>
<h2 id="contexto">Contexto</h2>
<p>En esta parte del desarrollo nos dedicamos a desarrollar una API CRUD con FAST API usando python. El objetivo principal de esta API es un sistema de control de stock para negocios, con capacidad de crear y contener usuarios. También, el agregado de los productos en stock, con sus características, entre ellas, nombre, código, precio, cantidad, descripción e imagen ilustrativa, la cual es subida a través de la API.</p>
<p>Además en esta instancia se tomó la decisión de la base de datos a usar, considerando el entorno de producción, al ser Kubernetes terminamos optando por MySQL, por facilidad de desplegar y para interactuar con la base de datos se utilizó el ORM SQLAlchemy.</p>
<p>Por último, desarrolló una interfaz de usuario (UI) basada en NODE JS, haciendo uso del framework Next JS, el cual permite el uso de componentes de React para generar aplicaciones multi página. A través de esta interfaz gráfica, el usuario será capaz de:</p>
<ul>
<li>Observar todos los productos registrados en la base de datos y filtrar por código o nombre de producto a través de una barra de búsqueda.</li>
<li>En caso de estar registrado como operador del sistema, se podrá acceder a un panel de administración.</li>
<li>A través del panel de administración, será posible agregar, editar o borrar productos. Al momento de editar o agregar un producto se podrá subir una imágen ilustrativa del mismo.</li>
<li>No se posee una interfaz de registro, estos se deberan hacer via API con ayuda de algun desarollador.</li>
<li>Cabe destacar que cada usuario tendra productos asociados a el, no podra ver ni operar sobre productos de otros usuarios en el panel de administracion.</li>
</ul>
<p>Para la etapa de desarrollo local, se utilizó Docker como herramienta de contenerización, que permite luego subir imágenes al Docker Hub. A través de la herramienta Docker Compose, la cual permitió simular un ambiente parecido al de producción.  </p>
<h2 id="como-generar-el-ambiente-de-desarrollo-local">Como generar el ambiente de desarrollo local</h2>
<p>Como primer paso, se debe tener instalado poetry y nodejs.</p>
<p>Primero, se deben instalar las dependencias de python con poetry.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>poetry<span class="w"> </span>install
</code></pre></div>
<p>Luego se debe igresar a la carpeta de la ui e instalar las dependencias de nodejs</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">cd</span><span class="w"> </span>./ui
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>npm<span class="w"> </span>install
</code></pre></div>
<p>Para ejecutar la aplicacion hace falta poseer docker instalado en el equipo, ademas se debe crear una copia de <code>.env.sample</code> y renombrarla como <code>.env</code> para que docker sea capaz de cargar las configuraciones.</p>
<p>Una vez realizado esto, para ejecutar el proyeco, se debe usar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--build
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w"> </span><span class="sb">```</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>Esto<span class="w"> </span>levantara<span class="w"> </span>la<span class="w"> </span>base<span class="w"> </span>de<span class="w"> </span>datos<span class="w"> </span><span class="o">(</span>MySQL<span class="o">)</span>,<span class="w"> </span>la<span class="w"> </span>API<span class="w"> </span>y<span class="w"> </span>la<span class="w"> </span><span class="o">(</span>UI<span class="o">)</span>.
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>El<span class="w"> </span>tag<span class="w"> </span><span class="sb">`</span>--build<span class="sb">`</span><span class="w"> </span>fuerza<span class="w"> </span>a<span class="w"> </span>que<span class="w"> </span>al<span class="w"> </span>inicio<span class="w"> </span>del<span class="w"> </span>despliegue<span class="w"> </span>se<span class="w"> </span>re<span class="w"> </span>cree<span class="w"> </span>la<span class="w"> </span>imagen<span class="w"> </span>de<span class="w"> </span>la<span class="w"> </span>API<span class="w"> </span>y<span class="w"> </span>UI.<span class="w"> </span>No<span class="w"> </span>seria<span class="w"> </span>necesario<span class="w"> </span>en<span class="w"> </span>un<span class="w"> </span>simple<span class="w"> </span>reinicio.
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>Para<span class="w"> </span>parar<span class="w"> </span>la<span class="w"> </span>infraestructura<span class="w"> </span>se<span class="w"> </span>debe<span class="w"> </span>usar:
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="sb">```</span>bash
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>docker<span class="w"> </span>compose<span class="w"> </span>down
</code></pre></div>
<p>En caso de querer correr en modo desarollo, se debe iniciar el deploy y luego utilizar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>down<span class="w"> </span>api
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1"># 0</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>docker<span class="w"> </span>compose<span class="w"> </span>down<span class="w"> </span>ui
</code></pre></div>
<p>El comando a seleccionar dependera de en que entorno se deba trabajar, dado que el primero da de baja el contenedor de API y el segundo el de la UI.</p>
<p>Para correr la API en modo desarollo se puede hacer uso de los sugientes comandos:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Usando poetry</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>poetry<span class="w"> </span>run<span class="w"> </span>uvicorn<span class="w"> </span>app.main:app<span class="w"> </span>--reload
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># o si la terminal ya se encuentra en el entorno virtual</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>uvicorn<span class="w"> </span>app.main:app<span class="w"> </span>--reload
</code></pre></div>
<p>Y en el caso de la UI dentro de la carpeta ui:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>npm<span class="w"> </span>run<span class="w"> </span>dev
</code></pre></div>
<h2 id="estructura">Estructura</h2>
<p>El proyecto, este se organiza internamente por carpetas:</p>
<p>La carpeta <code>app</code> contiene todo lo referente a la API, y se compone de las subcarpetas:</p>
<ul>
<li><code>api</code>: Contiene toda la logica corespondiente a las rutas de la API (Definicion de endpoints).</li>
<li><code>core</code>: Contiene utilidades generales al protecto de la API, como configuraciones globales.</li>
<li><code>crud</code>: Contiene las funciones CRUD (Create, Read, Update, Delete) las cuales interactuan con la base de datos.</li>
<li><code>db</code>: Contiene utilidades referidas a la conexion con la base de datos.</li>
<li><code>models</code>: Contiene las clases constructoras de objetos utilizadas en el proyecto. Se diferencian dos tipos de clases, la primera clases de SQLAlchemy y clases de Pydantic. Las primeras son las encargadas de generar las tablas en la base de datos y gestionar la recuperacion e insercion de datos y las segundas son utilizadas como respuestas de los endpoints.</li>
</ul>
<p>La carpeta <code>ui</code> contiene todo lo referente a la UI, esta se compone de las subcarpetas:</p>
<ul>
<li><code>components</code>: Contiene componentes de react utilizados en las diferentes paginas o en diferentes componentes.</li>
<li><code>pages</code>: Contiene la estructura de paginas y ruteo del servidor web. Es decir, el <code>index.ts</code> representa al <code>index.html</code> de <code>/</code>, mientras que el <code>/admin/index.ts</code> representa el <code>/admin/index.html</code>.</li>
<li>Dentro de pages a su ves notamos una carpeta <code>api</code>, la cual funciona de intermediario entre la API de Fast Api y el servidor web de nextjs. Mediante esta, podemos evitar exponer directamente la API a los clientes.</li>
<li><code>public</code>: Contiene los recursos publicos de la pagina web.</li>
<li><code>utils</code>: Contiene definicion de interfaces (Parecidas a las clases pero solo denotan una estructura de datos) y configuraciones como la ruta de la API.</li>
</ul>
<h3 id="aclaracion-sobre-nextjs">Aclaracion sobre NextJS</h3>
<p>Next.js es un framework basado en React que facilita la renderización del código en el servidor, entregando al cliente un conjunto de archivos HTML, CSS y JavaScript con la lógica de acciones correspondiente. Cada página React, definida como exportación por defecto, debe ser pre-renderizada y enviada al cliente. Además, el uso de <code>getServerSideProps</code> permite ejecutar código antes de la renderización, posibilitando la limitación de acceso a páginas basándose en la presencia de cookies. Por otro lado, las rutas de API ubicadas en <code>ui/pages/api</code> son procesadas en el servidor.</p>
<h2 id="ejemplos-y-pruebas">Ejemplos y pruebas</h2>
<p>Previo a la integracion con la UI, una vez todos los endpoints estaban desarollados, se procedio a probar cada uno de estos endpoints. Para esto se utilizo el Swagger que viene incorporado en Fast API que se encuentra en <code>http://localhost:8000/docs</code>:</p>
<p>Para todos los endpoints, a la hora probarlos, deberemos seguir estos dos pazos, desplegar dicho endpoint y seleccionar el boton <code>Try it out</code>.</p>
<p><img alt="Desplegar el endpoint" src="../img/usuario_desplegar.png" />
<img alt="Iniciar prueba del endpoint" src="../img/usuario_probar.png" /></p>
<p>En caso de querer crear un usuario:</p>
<p><img alt="Enviar datos" src="../img/usuario_insertar.png" />
<img alt="Revisar el resultado" src="../img/usuario_resultado.png" /></p>
<p>Para iniciar sesion con dicho usuario y mantener las credenciales guardadas para el resto de endpoints</p>
<p><img alt="Abir formulario de login" src="../img/login_abrir.png" />
<img alt="Login" src="../img/logear.png" /></p>
<p>Para crear un producto:</p>
<p><img alt="Crear producto" src="../img/producto_crear.png" /></p>
<p>Para obtener todos los productos debemos usar solo el boton <code>Try it out</code> sobre el endpoint <code>/products/get/all</code>.</p>
<p>Una vez comprobada la funcionalidad de dichos endpoints, se procedio a desarollar y probar la UI:</p>
<p><img alt="Pagina principal" src="../img/ui_principal.png" /></p>
<p>Si seleccionamos administrar, al no estar logeados, nos redireccionara a la pagina de login:</p>
<p><img alt="Login" src="../img/ui_login.png" /></p>
<p>Una vez logeados podemos ir a la pagina admin donde veremos nuestros productos, editarlos y borrarlos, ademas de agregarlos.</p>
<p><img alt="Panel admin" src="../img/ui_admin.png" /></p>
<p>Para agregar un producto:</p>
<p><img alt="Boton de agregar" src="../img/ui_agregar_1.png" />
<img alt="Interfaz de agregar" src="../img/ui_agregar_2.png" /></p>
<p>Para editar, la interfaz es la misma, solo que se accede del boton de editar.</p>
<p>Por ultimo para borrar, precionamos el icono de la papelera y nos saldra una confirmacion:</p>
<p><img alt="Borrado de productos" src="../img/ui_borrar.png" /></p>
<h1 id="como-levantar-un-cluster-y-desplegar-nuestra-aplicacion">Cómo levantar un Clúster y desplegar nuestra aplicación</h1>
<h2 id="vagrant">Vagrant</h2>
<p>Vagrant es una herramienta que podés usar para crear y gestionar entornos de desarrollo virtualizados de manera fácil y reproducible. Su uso típico es facilitar la creación de máquinas virtuales con configuraciones específicas para el desarrollo de proyectos.</p>
<p>Para comenzar un proyecto de Vagrant en el directorio /vagrant, el usuario puede seguir estos pasos:</p>
<h3 id="instalacion-de-vagrant">Instalación de Vagrant</h3>
<p>Antes que nada, necesitás instalar Vagrant en tu máquina. Esto se puede hacer descargando el instalador desde el sitio oficial y siguiendo las <a href="https://developer.hashicorp.com/vagrant/tutorials/getting-started/getting-started-install">instrucciones</a></p>
<h3 id="instalar-el-provider-de-virtualbox">Instalar el provider de VirtualBox</h3>
<p>Descargar de la  <a href="https://www.virtualbox.org/wiki/Linux_Downloads">página oficial</a>.</p>
<p><strong>¡Importante!</strong> Para poder configurar cierta red privada deberemos crear o modificar el archivo <code>/etc/vbox/networks.conf</code> añadiendo la red de la siguiente manera:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">sudo</span><span class="w"> </span><span class="n">su</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">echo</span><span class="w"> </span><span class="s2">&quot;* 0.0.0.0/0&quot;</span><span class="w"> </span><span class="o">&gt;</span> <span class="sr">/etc/</span><span class="n">vbox</span><span class="o">/</span><span class="n">networks</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>
<h3 id="crear-las-claves-publicas-y-privadas-para-las-conexiones-ssh">Crear las claves públicas y privadas para las conexiones SSH</h3>
<p>Creamos nuestra propia clave pública y privada con <code>ssh-keygen</code>, procuramos no poner passphrase para que no se la solicite a las VMs a la hora de iniciarlas.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># ~/.ssh/</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>&gt;<span class="w"> </span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-b<span class="w"> </span><span class="m">4096</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>Generating<span class="w"> </span>public/private<span class="w"> </span>rsa<span class="w"> </span>key<span class="w"> </span>pair.
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>Enter<span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>which<span class="w"> </span>to<span class="w"> </span>save<span class="w"> </span>the<span class="w"> </span>key<span class="w"> </span><span class="o">(</span>/home/aagustin/.ssh/id_rsa<span class="o">)</span>:<span class="w"> </span>vagrant_key
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>Enter<span class="w"> </span>passphrase<span class="w"> </span><span class="o">(</span>empty<span class="w"> </span><span class="k">for</span><span class="w"> </span>no<span class="w"> </span>passphrase<span class="o">)</span>:<span class="w"> </span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>Enter<span class="w"> </span>same<span class="w"> </span>passphrase<span class="w"> </span>again:<span class="w"> </span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>Your<span class="w"> </span>identification<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>saved<span class="w"> </span><span class="k">in</span><span class="w"> </span>vagrant_key
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>Your<span class="w"> </span>public<span class="w"> </span>key<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>saved<span class="w"> </span><span class="k">in</span><span class="w"> </span>vagrant_key.pub
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>The<span class="w"> </span>key<span class="w"> </span>fingerprint<span class="w"> </span>is:
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>SHA256:K4v2o7EKOLfjCMLk7zVD4v234234c06peueU<span class="w"> </span>aagustin@hp-agustin
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>The<span class="w"> </span>key<span class="err">&#39;</span>s<span class="w"> </span>randomart<span class="w"> </span>image<span class="w"> </span>is:
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>+---<span class="o">[</span>RSA<span class="w"> </span><span class="m">4096</span><span class="o">]</span>----+
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="p">|</span><span class="w">                 </span><span class="p">|</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="p">|</span><span class="w">                 </span><span class="p">|</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="p">|</span><span class="w">                 </span><span class="p">|</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="p">|</span><span class="w">                 </span><span class="p">|</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="p">|</span><span class="w"> </span>.<span class="w"> </span>.<span class="w"> </span>.<span class="w"> </span>.S<span class="w">     </span>.<span class="w">  </span><span class="p">|</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="p">|</span><span class="o">=</span><span class="w"> </span>.<span class="w"> </span><span class="m">3</span><span class="w"> </span>o<span class="w"> </span>..<span class="w">   </span>o..<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="p">|</span>*o.+.*....<span class="w"> </span>+.++.<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="p">|</span><span class="nv">o</span><span class="o">=</span>o.B4<span class="o">==</span><span class="w">  </span>.<span class="w"> </span>*++<span class="w">  </span><span class="p">|</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="p">|</span>..<span class="o">=</span>*+*<span class="o">=</span>++<span class="w"> </span>.+o.<span class="w"> </span>E<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>+----<span class="o">[</span>SHA256<span class="o">]</span>-----+
</code></pre></div>
<h2 id="instalacion-de-ansible">Instalación de Ansible</h2>
<p>Ejecutamos los siguientes comandos en nuestra máquina host:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>software-properties-common
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>sudo<span class="w"> </span>apt-add-repository<span class="w"> </span>ppa:ansible/ansible
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>
<h2 id="personalizar-nuestros-archivos-de-configuracion-y-aprovisionar">Personalizar nuestros archivos de configuración y aprovisionar</h2>
<h3 id="configuraciones-de-perfil">Configuraciones de perfil</h3>
<p>Ingresamos al archivo <code>ansible/group_vars/all.yml</code> y elegimos la cantidad de nodos que deseemos, también la versión de Kubernetes. Además seleccionamos los recursos.</p>
<p>En nuestro caso se dejó de la siguiente manera:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nn">---</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nt">settings</span><span class="p">:</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;test_api&#39;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="nt">users</span><span class="p">:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="nt">test_api</span><span class="p">:</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">      </span><span class="nt">prod_test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">      </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">      </span><span class="nt">user_dir_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/aagustin</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">      </span><span class="nt">node_home_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/vagrant</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">      </span><span class="nt">shared_folders</span><span class="p">:</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./shared_folder</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">          </span><span class="nt">vm_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/vagrant</span><span class="w"> </span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">      </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kubernetes Cluster</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">      </span><span class="nt">ssh</span><span class="p">:</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">        </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vagrant&quot;</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vagrant&quot;</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">        </span><span class="nt">private_key_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/aagustin/.ssh/vagrant_key</span><span class="w"> </span><span class="c1"># Crearse una para que funcione</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">        </span><span class="nt">public_key_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/aagustin/.ssh/vagrant_key.pub</span><span class="w"> </span><span class="c1"># Crearse una para que funcione</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">      </span><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">        </span><span class="nt">control</span><span class="p">:</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4096</span><span class="w"> </span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">        </span><span class="nt">workers</span><span class="p">:</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">          </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4096</span><span class="w"> </span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">      </span><span class="nt">network</span><span class="p">:</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">        </span><span class="nt">control_ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.100.171</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">        </span><span class="nt">dns_servers</span><span class="p">:</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.8.8.8</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1.1.1</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w">        </span><span class="nt">pod_cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.1.0/16</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">        </span><span class="nt">service_cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.17.1.0/18</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="w">      </span><span class="nt">software</span><span class="p">:</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="w">        </span><span class="nt">box</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bento/ubuntu-22.04</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w">        </span><span class="nt">calico</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.25.0</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="w">        </span><span class="nt">kubernetes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.26.1-00</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="w">        </span><span class="nt">os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xUbuntu_22.04</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="w">        </span><span class="nt">flannel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.23.0</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="w">        </span><span class="nt">contained</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.5</span>
</code></pre></div>
<h3 id="levantar-maquinas-virtuales-de-vagrant">Levantar máquinas virtuales de Vagrant</h3>
<p>Levantarlas:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># en &lt;project-dir&gt;/k8s/</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>vagrant<span class="w"> </span>up
</code></pre></div>
<p>Si deseamos eliminarlas:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># en &lt;project-dir&gt;/k8s/</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>vagrant<span class="w"> </span>destroy
</code></pre></div>
<h3 id="aprovisionamos-con-ansible">Aprovisionamos con Ansible</h3>
<p>Desde la máquina host, posicionados en <code>&lt;project-dir&gt;/k8s/</code>, ejecutaremos los siguientes comandos:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>ansible<span class="w"> </span>-i<span class="w"> </span>ansible/inventory_local.yml<span class="w"> </span>-m<span class="w"> </span>ping<span class="w"> </span>all
</code></pre></div>
<p>Y nos aseguraremos de tener respuesta de todos los nodos creados.</p>
<p>Y luego aprovisionamos con:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ansible-playbook<span class="w"> </span>-vvv<span class="w"> </span>ansible/site.yml<span class="w"> </span>-i<span class="w"> </span>ansible/inventory_local.yml
</code></pre></div>
<h2 id="acceso-a-los-nodos-mediante-ssh">Acceso a los nodos mediante SSH</h2>
<p>Para acceder al nodo master:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>ssh<span class="w"> </span>-i<span class="w"> </span>~/.ssh/vagrant_key<span class="w"> </span>vagrant@192.168.100.171
</code></pre></div>
<p>Si queremos entrar como <code>root</code> simplemente cambiamos el usuario a root.</p>
<h2 id="minikube">Minikube</h2>
<p>Se detectaron problemas de DNS en el Cluster de Vagrant, estos son fácilmente verificables generando un pod de test <a href="https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/">dns-utils</a> y aplicando el siguiente comando:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>-t<span class="w"> </span>dnsutils<span class="w"> </span>--<span class="w"> </span>nslookup<span class="w"> </span>&lt;nombre-servicio&gt;.svc.default.cluster.local
</code></pre></div>
<p>Donde deberíamos obtener la IP del servicio o del pod al que estamos queriendo llegar con ese dominio. En el caso del Cluster de Vagrant no se obtenían las direcciones IP correspondientes, esto nos asegura que el <code>core-dns</code> no está funcionando como corresponde lo que indica una mala intalación de <code>kubelet</code>.</p>
<p>Resulta, que por experiencias previas sabíamos que esto podía ser así debido a que la configuración propuesta de Vagrant no permite los reinicios debido a que se corrompen las carpetas compartidas y al no poder reiniciar no se aplican como corresponde las configuraciones pertinentes al aprovisionamiento de Kubernetes.</p>
<p>Dicho esto, y entendiendo además que se complican las pruebas en local, se tomó la decisión de conservar la versión utilizada de Kubernetes (1.26.1) y hacer uso de Minikube, una herramienta opensource que mediante la creación de una máquina virtual nos permite disponer de un entorno sencillo de Kubernetes con la mayor parte de sus funcionalidades.</p>
<p>Para levantar el cluster necesario, ya teniendo Minikube instalado, aplicamos el siguiente comando:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>minikube<span class="w"> </span>start<span class="w"> </span>--kubernetes-version<span class="o">=</span><span class="s1">&#39;1.26.1&#39;</span><span class="w"> </span>--memory<span class="o">=</span><span class="s1">&#39;4096&#39;</span><span class="w"> </span>--cpus<span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="w"> </span>--disk-size<span class="o">=</span><span class="s1">&#39;10GB&#39;</span><span class="w"> </span>--vm<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--nodes<span class="o">=</span><span class="m">2</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;test-1.26-2nodes&quot;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>minikube<span class="w"> </span>addons<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>metrics-server
</code></pre></div>
<p>Podemos borrar nuestro perfil creado haciendo:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>minikube<span class="w"> </span>delete<span class="w"> </span>-p<span class="w"> </span>test-1.26-2nodes
</code></pre></div>
<p>Podemos levantar el Dashboard para una mejor visualización de lo que ocurre con:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>minikube<span class="w"> </span>dashboard<span class="w"> </span>-p<span class="w"> </span>test-1.26-2nodes
</code></pre></div>
<h3 id="levantar-base-de-datos-mysql">Levantar base de datos MySQL</h3>
<h4 id="por-que-mysql-y-no-mongodb-u-alguna-otra">¿Por qué MySQL y no MongoDB u alguna otra?</h4>
<p>Se hizo la búsqueda de información pertinente para poder hacer una selección adecuada para los requerimientos y en la misma se encontró que entre las bases de datos más utilizadas dentro de los entornos de Kubernetes son MySQL y PostgressSQL y que además, el uso de una base de datos en un entorno de Kuebernetes no es una decisión que debamos tomar a la ligera, debido a que resulta muy complicado el mantenimiento y la misma configuración.</p>
<p>Entendiendo lo anterior, se optó por MySQL como base de datos para el proyecto y la misma se desplegará sobre Kubernetes en una configuración denominada "Statefulset", que permite desplegar nombres de pods y volúmenes persistentes.</p>
<h4 id="que-arquitectura-elegimos-y-por-que">¿Qué arquitectura elegimos y por qué?</h4>
<p>Se probaron 3 diferentes formas para levantar la base de datos en las cuales nos hemos topado con distitos inconvenientes por lo cuales hemos llegado a una decisión final.</p>
<p>Dentro de las pruebas se lograron diferenciar conceptos importantes:</p>
<h5 id="headless-services-vs-clusterip-services-vs-nodeport-services">Headless Services vs. ClusterIP Services vs. NodePort Services</h5>
<p>Los Headless Services no asignan una dirección IP virtual estable, en lugar de eso, devuelven directamente las IP de los pods seleccionados, se usa cuando necesitas acceder a cada instancia individualmente, por ejemplo, en bases de datos distribuidas. Estos realizan "loadbalancing" a la hora de tener que distribuir el tráfico (no le pegan siempre al mmismo pod).</p>
<p>Los ClusterIP Services asignan una IP virtual estable que representa el servicio y dirige el tráfico a los pods seleccionados. Son ideales para servicios internos en el clúster que solo necesitan ser accedidos internamente. Estos realizan balanceo de carga entre los pods seleccionados.</p>
<p>Los NodePort Services exponen el servicio en un puerto en cada nodo del clúster, permitiendo el acceso externo. Son útiles cuando necesitas acceder al servicio desde fuera del clúster, pero no es ideal para producción debido a posibles problemas de seguridad. Este tipo de servicio proporciona balanceo de carga entre los nodos, pero no entre los pods directamente.</p>
<h5 id="statefulset">Statefulset</h5>
<p>Es un controlador que mantiene un conjunto de pods con identidades únicas y persistentes. Se utiliza para aplicaciones que requieren identidades persistentes, como bases de datos, donde cada pod tiene un estado y un nombre único. Garantiza que los pods se creen y se escalen de manera ordenada, y proporciona almacenamiento persistente para cada pod.</p>
<p>A diferencia de Deployments, que son más adecuados para aplicaciones sin estado, un StatefulSet es ideal cuando se necesita mantener un estado específico y único para cada instancia, como en el caso de bases de datos.</p>
<p>Supongamos que tenemos un StatefulSet para una base de datos MySQL y decidimos llamar al  StatefulSet "mysql-db". La nomenclatura para los nombres de los pods y persistent volumes generados por el StatefulSet sería algo como:</p>
<ul>
<li>Pods generados por el StatefulSet:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>mysql-db-0
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>mysql-db-1
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>mysql-db-2
</code></pre></div>
<ul>
<li>Persistent Volumes generados por el StatefulSet:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>mysql-db-pv-0
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>mysql-db-pv-1
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>mysql-db-pv-2
</code></pre></div>
<p>Cada pod y cada volumen persistente tendría un nombre único basado en el nombre del StatefulSet y un índice que refleja su posición en la secuencia.</p>
<p>Ahora, si tuvieramos un Deployment común para una aplicación web llamado "web-app", los nombres de los pods generados serían más genéricos y probablemente se basarían en un identificador aleatorio o algún nombre de base, como:</p>
<ul>
<li>Pods generados por el Deployment:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>web-app-74d8b8b5f9-abcde
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>web-app-74d8b8b5f9-12345
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>web-app-74d8b8b5f9-xyzab
</code></pre></div>
<ul>
<li>Persistent Volumes generados por el Deployment: No habría persistent volumes específicos asociados directamente con los pods generados por el Deployment, a menos que configures almacenamiento persistente externamente.</li>
</ul>
<p>En resumen, la diferencia radica en la predictibilidad y consistencia de los nombres. Los StatefulSets generan nombres que reflejan la posición y el propósito específico del pod en la secuencia, mientras que los Deployments comunes pueden generar nombres más aleatorios o genéricos.</p>
<h5 id="replicar-la-base-de-datos">Replicar la base de datos</h5>
<p>Supongamos que gracias a los servicios configurados y nuestra API logramos escribir sobre la base de datos del Statefulset de MySQL, que para este ejemplo consta de 3 pods y por consiguiente 3 PV's.</p>
<p>Si hacemos intentos reiterados para escribir sobre la base de datos resultaría que, gracias al balanceo de cargas realizado por el servicio ClusterIP o Headless, escribiríamos algunos datos en una de las réplicas, otros en la siguiente y así sucesivamente, resultando que, cuando quisieramos leer, no obtendríamos todos los datos de una vez ya que cada réplica es una base de datos independientes y requerimos de una lógica extra para hacer la replicación de la información y así esta esté disponible en todas las replicas.</p>
<p>En el contexto de las DB, podemos configurar un conjunto de réplicas utilizando un controlador StatefulSet y configurar la replicación de cada tipo de DB dentro de los pods.</p>
<h5 id="eleccion-tomada">Elección tomada</h5>
<p>Entendiendo lo anterior, creemos que un Headless service y una configuración Statefulset es la major elección para desplegar nuestra base de datos.</p>
<p>A la hora de la configuración sobre Minikube se encontró que la configuración de replicación de la DB que nos ofrece de ejemplo la documentación de Kubernetes no funciona como corresponde.</p>
<p>Debido a lo nombrado anteriormente es que se optó por una base de datos en una configuración Statefulset pero que contenga una única réplica así nos olvidamos del problema de la no-replicación.</p>
<p><img alt="MySQL Structure" src="../img/mysql-structure.png" /></p>
<h4 id="manifiestos-de-kubernetes-de-la-db">Manifiestos de Kubernetes de la DB</h4>
<p>Aquí se brinda el manifiesto utilizado:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nn">---</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-headless</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="nn">---</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="c1"># $ echo -n &quot;root&quot; | base64</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="c1"># cm9vdA==</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w">   </span><span class="nt">ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cm9vdA==</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="nn">---</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-initdb-config</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="w">  </span><span class="nt">init.sql</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">    </span><span class="no">CREATE DATABASE IF NOT EXISTS api;</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="nn">---</span>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-headless</span>
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:5.7</span>
<a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_ROOT_PASSWORD</span>
<a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a><span class="w">              </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a><span class="w">               </span><span class="nt">secretKeyRef</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a><span class="w">                </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ROOT_PASSWORD</span>
<a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span>
<a id="__codelineno-22-60" name="__codelineno-22-60" href="#__codelineno-22-60"></a><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a id="__codelineno-22-61" name="__codelineno-22-61" href="#__codelineno-22-61"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-initdb</span>
<a id="__codelineno-22-62" name="__codelineno-22-62" href="#__codelineno-22-62"></a><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/docker-entrypoint-initdb.d</span>
<a id="__codelineno-22-63" name="__codelineno-22-63" href="#__codelineno-22-63"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<a id="__codelineno-22-64" name="__codelineno-22-64" href="#__codelineno-22-64"></a><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/mysql</span>
<a id="__codelineno-22-65" name="__codelineno-22-65" href="#__codelineno-22-65"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-22-66" name="__codelineno-22-66" href="#__codelineno-22-66"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-initdb</span>
<a id="__codelineno-22-67" name="__codelineno-22-67" href="#__codelineno-22-67"></a><span class="w">        </span><span class="nt">configMap</span><span class="p">:</span>
<a id="__codelineno-22-68" name="__codelineno-22-68" href="#__codelineno-22-68"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-initdb-config</span>
<a id="__codelineno-22-69" name="__codelineno-22-69" href="#__codelineno-22-69"></a><span class="w">  </span><span class="nt">volumeClaimTemplates</span><span class="p">:</span>
<a id="__codelineno-22-70" name="__codelineno-22-70" href="#__codelineno-22-70"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-22-71" name="__codelineno-22-71" href="#__codelineno-22-71"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<a id="__codelineno-22-72" name="__codelineno-22-72" href="#__codelineno-22-72"></a><span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-22-73" name="__codelineno-22-73" href="#__codelineno-22-73"></a><span class="w">        </span><span class="nt">accessModes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;ReadWriteOnce&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<a id="__codelineno-22-74" name="__codelineno-22-74" href="#__codelineno-22-74"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-22-75" name="__codelineno-22-75" href="#__codelineno-22-75"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-22-76" name="__codelineno-22-76" href="#__codelineno-22-76"></a><span class="w">            </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</code></pre></div>
<p>Desplegar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>&lt;nombre-manifiesto-db&gt;.yaml
</code></pre></div>
<p>Eliminar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>&lt;nombre-manifiesto-db&gt;.yaml
</code></pre></div>
<p>La DB quedará accesible entonces vía el siguiente dominio:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>mysql+pymysql://root:root@mysql-0.mysql-headless.default.svc.cluster.local:3306/api
</code></pre></div>
<h3 id="backend-desplegar-la-api">Backend - Desplegar la API</h3>
<p>La API debe ser accesible por fuera con el uso de un servicio tipo NodePort y a su vez debe poder acceder a la DB mediante el uso de DNS, pegandole al pod correspondiente (o al servicio, da igual porque tenemos un único pod) de la DB.</p>
<p>Para ello se creó el siguiente manifiesto:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span><span class="w"> </span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">31000</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="nn">---</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-backend-fastapi</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aagustinconti/fast-api-products:latest</span><span class="w"> </span><span class="c1">#DockerHub repo</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_HOST</span>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-0.mysql-headless.default.svc.cluster.local</span>
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD</span>
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE</span>
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI</span>
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;mysql+pymysql://root:root@mysql-0.mysql-headless.default.svc.cluster.local:3306/todo&#39;</span>
</code></pre></div>
<p>Desplegar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>&lt;nombre-manifiesto-api&gt;.yaml
</code></pre></div>
<p>Eliminar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>&lt;nombre-manifiesto-api&gt;.yaml
</code></pre></div>
<p>Como dato a tener en cuenta, la API estará disponible en el puerto 31000 de la IP del nodo worker. Internamente el container tendrá expuesto el puerto 8000, el cual estará apuntado por el servicio tipo NodePort para poder exponerlo al 31000, justamente.</p>
<p>Otro dato importante es que se tuvo que dockerizar la API y subir la imagen al DockerHub para que Kubernetes la pueda descargar, como se ve, esta está disponible en <code>aagustinconti/fast-api-products:latest</code>.</p>
<p>La gráfica quedaría de la siguiente manera:</p>
<p><img alt="Diagram API" src="../img/diagram-api.png" /></p>
<h3 id="frontend-desplegar-la-ui">Frontend - Desplegar la UI</h3>
<p>La UI debe poder comunicarse con la API y y a su vez debe ser accesible desde el puerto 80 de la IP del nodo así los usuarios pueden acceder a la misma. Para lo anterior se creó otro servicio tipo NodePort y a su vez se le pasaron los datos importantes para que se pueda conectar a la API, como el host: <code>mysql-0.mysql-headless.default.svc.cluster.local</code>, la clave, el usuario y la DB.</p>
<p>El manifiesto utilizado fue el siguiente:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>apiVersion: v1
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>kind: Service
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>metadata:
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>  name: ui 
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>spec:
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>  type: NodePort
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>  ports:
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>    - port: 80
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>      targetPort: 80
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>      nodePort: 30001
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>  selector:
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>    app: ui
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>---
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>apiVersion: apps/v1
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>kind: Deployment
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>metadata:
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>  name: ui
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>  labels:
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>    app: ui
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>spec:
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>  replicas: 1
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a>  selector:
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a>    matchLabels:
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>      app: ui
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>  template:
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>    metadata:
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>      labels:
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a>        app: ui
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>    spec:
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a>      containers:
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>        - name: api-frontend-node
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a>          image: aagustinconti/ui-node-products:latest # DockerHub repo
<a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a>          ports:
<a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a>            - containerPort: 80
<a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a>          imagePullPolicy: Always
<a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a>          env:
<a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a>          # &lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local:&lt;service-port&gt;
<a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a>          - name: API_URL
<a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a>            value: &#39;http://api:8000&#39;
<a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a>          - name: PORT
<a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a>            value: &#39;80&#39;
</code></pre></div>
<p>Desplegar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>&lt;nombre-manifiesto-ui&gt;.yaml
</code></pre></div>
<p>Eliminar:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>&lt;nombre-manifiesto-ui&gt;.yaml
</code></pre></div>
<p>Nuevamente se utilizó Docker para crear la imágen y subirla al DockerHub para que sea accesible por Kubernetes a través de <code>aagustinconti/ui-node-products:latest</code>.</p>
<p>Por otro lado debemos observar algo clave, entre los valores de las variables de entorno que le suministramos, encontramos que encuentra perfectamente a la api mediante el servicio "api" en el puerto 8000 (utilizando la resolución de DNS).</p>
<p>El diagrama queda como sigue:</p>
<p><img alt="Diagrama UI" src="../img/diagrama-ui.png" /></p>
<h3 id="como-paso-la-dockerfile-a-dockerhub">¿Como paso la Dockerfile a DockerHub?</h3>
<ol>
<li>
<p>Crearse una cuenta en <a href="https://hub.docker.com/u/aagustinconti">DockerHub</a></p>
</li>
<li>
<p>Crear un repositorio público</p>
</li>
</ol>
<p><img alt="Dockerhub" src="../img/dockerhub.png" /></p>
<ol>
<li>Buildear la imágen en local</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>./app/Dockerfile<span class="w"> </span>.
</code></pre></div>
<ol>
<li>Checkeamos la creación de la imágen</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>docker<span class="w"> </span>images
</code></pre></div>
<ol>
<li>Aplicar el siguiente comando</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>docker<span class="w"> </span>tag<span class="w"> </span>&lt;nombre-imagen&gt;<span class="w"> </span>&lt;dockerhub-user&gt;/&lt;nombre-imagen&gt;
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>docker<span class="w"> </span>push<span class="w"> </span>&lt;dockerhub-user&gt;/&lt;nombre-repositorio-dockerhub&gt;
</code></pre></div>
<h2 id="monitoreo-de-los-recursos-utilizados">Monitoreo de los recursos utilizados</h2>
<h3 id="grafana-y-prometheus">Grafana y Prometheus</h3>
<h4 id="instalacion">Instalación</h4>
<ol>
<li>Descargar repositorio del operador:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/prometheus-operator/kube-prometheus.git
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="nb">cd</span><span class="w"> </span>kube-prometheus
</code></pre></div>
<ol>
<li>Instalar el operador:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>--server-side<span class="w"> </span>-f<span class="w"> </span>manifests/setup
</code></pre></div>
<ol>
<li>Instalar todos los elementos:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>manifests<span class="w"> </span>
</code></pre></div>
<ol>
<li>Checkeamos que se hayan levantado todos los servicios, replicasets y pods:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>monitoring
</code></pre></div>
<ol>
<li>Editamos los servicios para poder exponerlos, de ClusterIP a NodePort a todos:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>kubectl<span class="w"> </span>edit<span class="w"> </span>svc<span class="w"> </span>grafana<span class="w"> </span>-n<span class="w"> </span>monitoring
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>kubectl<span class="w"> </span>edit<span class="w"> </span>svc<span class="w"> </span>prometheus-k8s<span class="w"> </span>-n<span class="w"> </span>monitoring
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>kubectl<span class="w"> </span>edit<span class="w"> </span>svc<span class="w"> </span>alertmanager-main<span class="w"> </span>-n<span class="w"> </span>monitoring
</code></pre></div>
<ol>
<li>Listamos los nodos, buscamos la IP del worker:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<ol>
<li>Listamos todos los servicios y buscamos el puerto al que se ha expuesto:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-A
</code></pre></div>
<blockquote>
<p>Checkeamos los puertos <code>grafana</code>, <code>prometheus-k8s</code> y <code>alertmanager-main</code> que tengan "NodePort".</p>
</blockquote>
<ol>
<li>Ingresamos a <code>&lt;ip-nodo-worker&gt;:&lt;puerto-svc&gt;</code></li>
</ol>
<h4 id="ejemplo-grafana">Ejemplo grafana</h4>
<p><img alt="Ejemplo Grafana" src="../img/ejemplo-grafana.png" /></p>
<blockquote>
<p>user: <code>admin</code>, psw: <code>admin</code></p>
</blockquote>
<p>Añadimos de datasource a Prometheus y configuramos un dashboard con algunos datos, por ejemplo, memoria disponible:</p>
<p><img alt="Ejemplo basico prometheus" src="../img/ejemplo-basico-prometheus.png" /></p>
<p><img alt="Ejemplo completo prometheus" src="../img/ejemplo-completo-prometheus.png" /></p>
<h4 id="levantar-la-base-de-datos-mysql-en-grafana">Levantar la base de datos MySQL en Grafana</h4>
<p>Vamos a <code>Data Sources</code>, luego <code>Add Data Sources</code>, luego elegimos MySQL y colocamos:</p>
<ul>
<li>Host URL: <code>mysql-0.mysql-headless.default.svc.cluster.local:3306</code></li>
<li>Database name: <code>&lt;nombre-db&gt;</code></li>
<li>Username: <code>root</code></li>
<li>Password: <code>root</code></li>
</ul>
<p>Hacemos click en <code>Save and Test</code>.</p>
<p>Luego podremos crear un dashboard donde traigamos como tabla, por ejemplo, los datos de la tabla:</p>
<p><img alt="Ejemplo grafana DB" src="../img/ejemplo-grafana-db.png" /></p>
<h1 id="k6">k6</h1>
<h2 id="que-es-k6">¿Qué es k6?</h2>
<p>k6 es una herramienta de código abierto destinada a realizar pruebas de carga y rendimiento en aplicaciones y servicios web. Utilizando JavaScript/ES6 para escribir scripts de prueba, k6 destaca por su sencilla sintaxis y soporte para protocolos como HTTP/1.1, HTTP/2 y WebSockets. Diseñado para ejecutarse en la nube y ser fácilmente integrado en flujos de trabajo de CI/CD, k6 proporciona informes detallados y métricas para evaluar el rendimiento de las aplicaciones bajo diversas condiciones de carga. Su flexibilidad y extensibilidad lo convierten en una herramienta valiosa para evaluar y mejorar la escalabilidad de sistemas web.</p>
<p>Entonces, k6 simplifica la realización de pruebas de rendimiento al ofrecer una solución basada en JavaScript con características como integración en la nube, generación de informes detallados y soporte para varios protocolos, proporcionando a los equipos de desarrollo la capacidad de evaluar y optimizar el rendimiento de sus aplicaciones de manera efectiva.</p>
<p>Gracias a ella pudimos plantear pruebas de stress locales hacia diferentes host y endpoints de nuestra api para poder verificar el cumplimiento de los requerimientos acordados con el cliente.</p>
<h2 id="k6-junto-con-prometheus-y-grafana">K6 junto con Prometheus y Grafana</h2>
<p>La visualización de datos a través de Grafana en conjunto con Prometheus ofrece una visión integral y en tiempo real del rendimiento del cluster que hospeda la aplicación. Al integrar estadísticas proporcionadas por k6 con los datos de consumo de recursos obtenidos mediante Prometheus, los equipos de desarrollo y operaciones pueden identificar patrones y correlaciones significativas. Esto permite una comprensión profunda de cómo las pruebas de carga impactan los recursos del cluster y cómo estos afectan directamente al rendimiento de la aplicación en producción. Grafana, con sus capacidades de visualización altamente personalizables, proporciona paneles intuitivos y gráficos dinámicos que facilitan la identificación de tendencias, cuellos de botella y áreas de mejora, permitiendo una toma de decisiones informada para optimizar la escalabilidad y la eficiencia del sistema.</p>
<p>La combinación de k6, Prometheus y Grafana proporciona una sinergia poderosa al permitir que los equipos monitoreen y analicen simultáneamente el rendimiento de las pruebas de carga y el comportamiento del cluster en producción. Esta integración facilita la identificación proactiva de posibles problemas y la optimización continua del rendimiento, respaldando la toma de decisiones basada en datos con una representación visual clara y detallada de la salud y eficiencia del sistema en tiempo real.</p>
<h2 id="instalacion-de-k6">Instalación de k6</h2>
<p>En Debian/Ubuntu, seguimos los pasos de la <a href="https://k6.io/docs/get-started/installation/">página de K6</a>.</p>
<p>Simplemente correremos en consola lo siguiente:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>sudo<span class="w"> </span>gpg<span class="w"> </span>-k
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>sudo<span class="w"> </span>gpg<span class="w"> </span>--no-default-keyring<span class="w"> </span>--keyring<span class="w"> </span>/usr/share/keyrings/k6-archive-keyring.gpg<span class="w"> </span>--keyserver<span class="w"> </span>hkp://keyserver.ubuntu.com:80<span class="w"> </span>--recv-keys<span class="w"> </span>C5AD17C747E3415A3642D57D77C6C491D6AC1D69
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/k6.list
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>k6
</code></pre></div>
<h3 id="correr-el-test-de-carga">Correr el test de carga</h3>
<p>Para correr cualquier test lo único que debemos hacer es poner en consola lo siguiente:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1"># on k6 dir</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>k6<span class="w"> </span>run<span class="w"> </span>test-api/&lt;nombre-del-test&gt;.js
</code></pre></div>
<h2 id="pruebas-realizadas">Pruebas realizadas</h2>
<p>Las pruebas se centraron en cumplir con los requisitos de resistencia del cliente, priorizando la capacidad de la interfaz de usuario para soportar más de 5000 usuarios simultáneos en su página principal. Además, se llevaron a cabo pruebas adicionales, como la creación masiva de usuarios y productos para evaluar la robustez de la API y la base de datos. Otra prueba se centró en medir el consumo de red al recuperar datos en formato base64 de imágenes completas desde la base de datos. Por último, se evaluó el rendimiento del procesamiento de la API, incluyendo pruebas de carga en el proceso de inicio de sesión que involucra tokens y contraseñas encriptadas con BCrypt. En todos los escenarios, se monitorearon detenidamente la CPU, la RAM, la lectura/escritura del disco y el consumo de red para obtener una visión completa del rendimiento del sistema.</p>
<h3 id="test-1-ui">Test 1: UI</h3>
<p>Archivo de configuración de K6 utilizado:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6/http&#39;</span><span class="p">;</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">sleep</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6&#39;</span><span class="p">;</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">  </span><span class="nx">stages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;15s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;30s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">2500</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">5000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">  </span><span class="p">],</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="p">};</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://192.168.39.203:30001/&#39;</span><span class="p">);</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">  </span><span class="nx">sleep</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="p">}</span>
</code></pre></div>
<p>Resultado de consola de k6:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="w">     </span>data_received..................:<span class="w"> </span><span class="m">141</span><span class="w"> </span>MB<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>MB/s
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">     </span>data_sent......................:<span class="w"> </span><span class="m">1</span>.3<span class="w"> </span>MB<span class="w"> </span><span class="m">10</span><span class="w"> </span>kB/s
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">     </span>http_req_blocked...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">74</span>.96ms<span class="w">  </span><span class="nv">min</span><span class="o">=</span>951ns<span class="w">  </span><span class="nv">med</span><span class="o">=</span><span class="m">5</span>.29µs<span class="w">  </span><span class="nv">max</span><span class="o">=</span><span class="m">7</span>.3s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">529</span>.72µs<span class="w"> </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">5</span>.64ms<span class="w">  </span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">     </span>http_req_connecting............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">42</span>.82ms<span class="w">  </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">     </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">      </span><span class="nv">max</span><span class="o">=</span><span class="m">7</span>.3s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">357</span>.86µs<span class="w"> </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">447</span>.3µs<span class="w"> </span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">     </span>http_req_duration..............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">25</span>.35s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">8</span>.63ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">23</span>.68s<span class="w">  </span><span class="nv">max</span><span class="o">=</span>1m0s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">46</span>.43s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">49</span>.46s<span class="w">  </span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">       </span><span class="o">{</span><span class="w"> </span>expected_response:true<span class="w"> </span><span class="o">}</span>...:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">24</span>.8s<span class="w">    </span><span class="nv">min</span><span class="o">=</span><span class="m">8</span>.63ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">23</span>.67s<span class="w">  </span><span class="nv">max</span><span class="o">=</span><span class="m">59</span>.98s<span class="w"> </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">44</span>.26s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">47</span>.46s<span class="w">  </span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">     </span>http_req_failed................:<span class="w"> </span><span class="m">1</span>.57%<span class="w">  </span>✓<span class="w"> </span><span class="m">227</span><span class="w">        </span>✗<span class="w"> </span><span class="m">14208</span><span class="w"> </span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">     </span>http_req_receiving.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">84</span>.93µs<span class="w">  </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">     </span><span class="nv">med</span><span class="o">=</span><span class="m">80</span>.47µs<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">4</span>.41ms<span class="w"> </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">113</span>.12µs<span class="w"> </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">127</span>.36µs
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">     </span>http_req_sending...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">430</span>.38ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span><span class="m">5</span>.32µs<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">21</span>.77µs<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">9</span>.55s<span class="w">  </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">83</span>.96µs<span class="w">  </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">4</span>.17s<span class="w">   </span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="w">     </span>http_req_tls_handshaking.......:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">     </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">      </span><span class="nv">max</span><span class="o">=</span>0s<span class="w">     </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>0s<span class="w">      </span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">     </span>http_req_waiting...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">24</span>.92s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">8</span>.44ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">23</span>.68s<span class="w">  </span><span class="nv">max</span><span class="o">=</span>1m0s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">41</span>.57s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">49</span>.46s<span class="w">  </span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">     </span>http_reqs......................:<span class="w"> </span><span class="m">14435</span><span class="w">  </span><span class="m">110</span>.617989/s
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">     </span>iteration_duration.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">26</span>.4s<span class="w">    </span><span class="nv">min</span><span class="o">=</span>1s<span class="w">     </span><span class="nv">med</span><span class="o">=</span><span class="m">24</span>.69s<span class="w">  </span><span class="nv">max</span><span class="o">=</span>1m1s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">47</span>.43s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">50</span>.46s<span class="w">  </span>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">     </span>iterations.....................:<span class="w"> </span><span class="m">14435</span><span class="w">  </span><span class="m">110</span>.617989/s
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">     </span>vus............................:<span class="w"> </span><span class="m">744</span><span class="w">    </span><span class="nv">min</span><span class="o">=</span><span class="m">42</span><span class="w">       </span><span class="nv">max</span><span class="o">=</span><span class="m">4984</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">     </span>vus_max........................:<span class="w"> </span><span class="m">5000</span><span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">5000</span><span class="w">     </span><span class="nv">max</span><span class="o">=</span><span class="m">5000</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a>
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a>running<span class="w"> </span><span class="o">(</span>2m10.5s<span class="o">)</span>,<span class="w"> </span><span class="m">0000</span>/5000<span class="w"> </span>VUs,<span class="w"> </span><span class="m">14435</span><span class="w"> </span><span class="nb">complete</span><span class="w"> </span>and<span class="w"> </span><span class="m">0</span><span class="w"> </span>interrupted<span class="w"> </span>iterations
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a>default<span class="w"> </span>✓<span class="w"> </span><span class="o">[======================================]</span><span class="w"> </span><span class="m">0000</span>/5000<span class="w"> </span>VUs<span class="w">  </span>1m45s
</code></pre></div>
<p>Resultado de Grafana:</p>
<p><img alt="CPU usage" src="../img/test1-cpu.png" />
<img alt="Network traffic" src="../img/test1-network.png" />
<img alt="Memory usage" src="../img/test1-memory.png" />
<img alt="Disk usage" src="../img/test1-disk-usage.png" /></p>
<h3 id="test-2-user-login">Test 2: User login</h3>
<p>Archivo de configuración de K6 utilizado:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6/http&#39;</span><span class="p">;</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">check</span><span class="p">,</span><span class="w"> </span><span class="nx">sleep</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6&#39;</span><span class="p">;</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">  </span><span class="nx">stages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;15s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;30s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">2500</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">5000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">  </span><span class="p">],</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="p">};</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">  </span><span class="c1">// Datos del usuario para el login</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;aagustin@gmail.com&#39;</span><span class="p">;</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;12345678&#39;</span><span class="p">;</span>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a>
<a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="w">  </span><span class="c1">// Realizar la solicitud POST para el login del usuario</span>
<a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://192.168.39.203:31000/auth/login&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="w">    </span><span class="nx">grant_type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a><span class="w">    </span><span class="nx">username</span><span class="p">,</span>
<a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a><span class="w">    </span><span class="nx">password</span><span class="p">,</span>
<a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a><span class="w">    </span><span class="nx">scope</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a><span class="w">    </span><span class="nx">client_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a><span class="w">    </span><span class="nx">client_secret</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a><span class="w">      </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
<a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a><span class="w">      </span><span class="s1">&#39;Accept&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a>
<a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a><span class="w">  </span><span class="c1">// Verificar si la respuesta es exitosa (código 2xx)</span>
<a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a><span class="w">  </span><span class="nx">check</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a><span class="w">    </span><span class="s1">&#39;status was 2xx&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">300</span><span class="p">,</span>
<a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a>
<a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a><span class="w">  </span><span class="c1">// Introducir una pausa de 1 segundo entre las solicitudes</span>
<a id="__codelineno-48-38" name="__codelineno-48-38" href="#__codelineno-48-38"></a><span class="w">  </span><span class="nx">sleep</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-48-39" name="__codelineno-48-39" href="#__codelineno-48-39"></a><span class="p">}</span>
</code></pre></div>
<p>Resultado de consola de k6:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="w">     </span>✗<span class="w"> </span>status<span class="w"> </span>was<span class="w"> </span>2xx
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="w">      </span>↳<span class="w">  </span><span class="m">3</span>%<span class="w"> </span>—<span class="w"> </span>✓<span class="w"> </span><span class="m">407</span><span class="w"> </span>/<span class="w"> </span>✗<span class="w"> </span><span class="m">12074</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">     </span>checks.........................:<span class="w"> </span><span class="m">3</span>.26%<span class="w">  </span>✓<span class="w"> </span><span class="m">407</span><span class="w">       </span>✗<span class="w"> </span><span class="m">12074</span><span class="w"> </span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">     </span>data_received..................:<span class="w"> </span><span class="m">126</span><span class="w"> </span>kB<span class="w"> </span><span class="m">993</span><span class="w"> </span>B/s
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">     </span>data_sent......................:<span class="w"> </span><span class="m">3</span>.5<span class="w"> </span>MB<span class="w"> </span><span class="m">28</span><span class="w"> </span>kB/s
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">     </span>http_req_blocked...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">513</span>.73ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span><span class="m">2</span>.45µs<span class="w">   </span><span class="nv">med</span><span class="o">=</span><span class="m">1</span>.11ms<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">3</span>.13s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">3</span>.02s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">3</span>.03s<span class="w"> </span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">     </span>http_req_connecting............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">513</span>.25ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">med</span><span class="o">=</span><span class="m">949</span>.58µs<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">3</span>.05s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">3</span>.02s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">3</span>.03s<span class="w"> </span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">     </span>http_req_duration..............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">29</span>.51s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">452</span>.04ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">31</span>.15s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">50</span>.44s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">37</span>.05s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">41</span>.74s
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">       </span><span class="o">{</span><span class="w"> </span>expected_response:true<span class="w"> </span><span class="o">}</span>...:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">9</span>.24s<span class="w">    </span><span class="nv">min</span><span class="o">=</span><span class="m">452</span>.04ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">7</span>.96s<span class="w">    </span><span class="nv">max</span><span class="o">=</span><span class="m">32</span>.5s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">19</span>.42s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">27</span>.41s
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">     </span>http_req_failed................:<span class="w"> </span><span class="m">96</span>.73%<span class="w"> </span>✓<span class="w"> </span><span class="m">12074</span><span class="w">     </span>✗<span class="w"> </span><span class="m">407</span><span class="w">   </span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="w">     </span>http_req_receiving.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">4</span>.57µs<span class="w">   </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">max</span><span class="o">=</span><span class="m">8</span>.86ms<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>0s<span class="w">    </span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">     </span>http_req_sending...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">718</span>.89µs<span class="w"> </span><span class="nv">min</span><span class="o">=</span><span class="m">11</span>.89µs<span class="w">  </span><span class="nv">med</span><span class="o">=</span><span class="m">66</span>.83µs<span class="w">  </span><span class="nv">max</span><span class="o">=</span><span class="m">101</span>.88ms<span class="w"> </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">510</span>.25µs<span class="w"> </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">1</span>.15ms
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">     </span>http_req_tls_handshaking.......:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">max</span><span class="o">=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>0s<span class="w">    </span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="w">     </span>http_req_waiting...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">29</span>.51s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">451</span>.86ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">31</span>.15s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">50</span>.44s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">37</span>.05s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">41</span>.74s
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="w">     </span>http_reqs......................:<span class="w"> </span><span class="m">12481</span><span class="w">  </span><span class="m">98</span>.263787/s
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="w">     </span>iteration_duration.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">31</span>.22s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">1</span>.46s<span class="w">    </span><span class="nv">med</span><span class="o">=</span><span class="m">33</span>.61s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">51</span>.91s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">38</span>.37s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">43</span>.05s
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="w">     </span>iterations.....................:<span class="w"> </span><span class="m">12481</span><span class="w">  </span><span class="m">98</span>.263787/s
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="w">     </span>vus............................:<span class="w"> </span><span class="m">982</span><span class="w">    </span><span class="nv">min</span><span class="o">=</span><span class="m">41</span><span class="w">      </span><span class="nv">max</span><span class="o">=</span><span class="m">4995</span>
<a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="w">     </span>vus_max........................:<span class="w"> </span><span class="m">5000</span><span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">5000</span><span class="w">    </span><span class="nv">max</span><span class="o">=</span><span class="m">5000</span>
<a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a>
<a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a>
<a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a>running<span class="w"> </span><span class="o">(</span>2m07.0s<span class="o">)</span>,<span class="w"> </span><span class="m">0000</span>/5000<span class="w"> </span>VUs,<span class="w"> </span><span class="m">12481</span><span class="w"> </span><span class="nb">complete</span><span class="w"> </span>and<span class="w"> </span><span class="m">0</span><span class="w"> </span>interrupted<span class="w"> </span>iterations
<a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a>default<span class="w"> </span>✓<span class="w"> </span><span class="o">[======================================]</span><span class="w"> </span><span class="m">0000</span>/5000<span class="w"> </span>VUs<span class="w">  </span>1m45s
</code></pre></div>
<p>Resultado de Grafana:</p>
<p><img alt="CPU usage" src="../img/test2-cpu.png" />
<img alt="Network traffic" src="../img/test2-network.png" />
<img alt="Memory usage" src="../img/test2-memory.png" />
<img alt="Disk usage" src="../img/test2-disk-usage.png" /></p>
<h3 id="test-3-register-new-users">Test 3: Register new users</h3>
<p>Archivo de configuración de K6 utilizado:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6/http&#39;</span><span class="p">;</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">check</span><span class="p">,</span><span class="w"> </span><span class="nx">sleep</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6&#39;</span><span class="p">;</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="c1">// Función para generar una cadena aleatoria de longitud dada</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="kd">function</span><span class="w"> </span><span class="nx">generateRandomString</span><span class="p">(</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span><span class="p">;</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">randomIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">charset</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">charset</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">randomIndex</span><span class="p">);</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="p">}</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">  </span><span class="nx">stages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;15s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;30s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">2500</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">5000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">  </span><span class="p">],</span>
<a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="p">};</span>
<a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a>
<a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">  </span><span class="c1">// Generar datos aleatorios para cada usuario</span>
<a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`user</span><span class="si">${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100000</span><span class="p">)</span><span class="si">}</span><span class="sb">@example.com`</span><span class="p">;</span>
<a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateRandomString</span><span class="p">(</span><span class="mf">8</span><span class="p">);</span>
<a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a>
<a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="w">  </span><span class="c1">// Crear el objeto de usuario</span>
<a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a><span class="w">    </span><span class="nx">email</span><span class="p">,</span>
<a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="w">    </span><span class="nx">password</span><span class="p">,</span>
<a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a>
<a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a><span class="w">  </span><span class="c1">// Realizar la solicitud POST para registrar un nuevo usuario</span>
<a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://192.168.39.203:31000/auth/register&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a><span class="w">      </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<a id="__codelineno-50-38" name="__codelineno-50-38" href="#__codelineno-50-38"></a><span class="w">      </span><span class="s1">&#39;Accept&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<a id="__codelineno-50-39" name="__codelineno-50-39" href="#__codelineno-50-39"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-50-40" name="__codelineno-50-40" href="#__codelineno-50-40"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-50-41" name="__codelineno-50-41" href="#__codelineno-50-41"></a>
<a id="__codelineno-50-42" name="__codelineno-50-42" href="#__codelineno-50-42"></a><span class="w">  </span><span class="c1">// Verificar si la respuesta es exitosa (código 2xx)</span>
<a id="__codelineno-50-43" name="__codelineno-50-43" href="#__codelineno-50-43"></a><span class="w">  </span><span class="nx">check</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-44" name="__codelineno-50-44" href="#__codelineno-50-44"></a><span class="w">    </span><span class="s1">&#39;status was 2xx&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">300</span><span class="p">,</span>
<a id="__codelineno-50-45" name="__codelineno-50-45" href="#__codelineno-50-45"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-50-46" name="__codelineno-50-46" href="#__codelineno-50-46"></a>
<a id="__codelineno-50-47" name="__codelineno-50-47" href="#__codelineno-50-47"></a><span class="w">  </span><span class="c1">// Introducir una pausa de 1 segundo entre las solicitudes</span>
<a id="__codelineno-50-48" name="__codelineno-50-48" href="#__codelineno-50-48"></a><span class="w">  </span><span class="nx">sleep</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-50-49" name="__codelineno-50-49" href="#__codelineno-50-49"></a><span class="p">}</span>
</code></pre></div>
<p>Resultado de consola de k6:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="w"> </span>✗<span class="w"> </span>status<span class="w"> </span>was<span class="w"> </span>2xx
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">      </span>↳<span class="w">  </span><span class="m">2</span>%<span class="w"> </span>—<span class="w"> </span>✓<span class="w"> </span><span class="m">345</span><span class="w"> </span>/<span class="w"> </span>✗<span class="w"> </span><span class="m">11276</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">     </span>checks.........................:<span class="w"> </span><span class="m">2</span>.96%<span class="w">  </span>✓<span class="w"> </span><span class="m">345</span><span class="w">       </span>✗<span class="w"> </span><span class="m">11276</span><span class="w"> </span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">     </span>data_received..................:<span class="w"> </span><span class="m">122</span><span class="w"> </span>kB<span class="w"> </span><span class="m">952</span><span class="w"> </span>B/s
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">     </span>data_sent......................:<span class="w"> </span><span class="m">2</span>.8<span class="w"> </span>MB<span class="w"> </span><span class="m">22</span><span class="w"> </span>kB/s
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">     </span>http_req_blocked...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">241</span>.39ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span><span class="m">2</span>.51µs<span class="w">   </span><span class="nv">med</span><span class="o">=</span><span class="m">610</span>.72µs<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">7</span>.14s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">1</span>.03s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">1</span>.05s<span class="w"> </span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">     </span>http_req_connecting............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">241</span>.29ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">med</span><span class="o">=</span><span class="m">532</span>.82µs<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">7</span>.14s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">1</span>.03s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">1</span>.05s<span class="w"> </span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">     </span>http_req_duration..............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">31</span>.44s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">372</span>.26ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">31</span>.69s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">58</span>.3s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">41</span>.86s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">46</span>.66s
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">       </span><span class="o">{</span><span class="w"> </span>expected_response:true<span class="w"> </span><span class="o">}</span>...:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">8</span>.98s<span class="w">    </span><span class="nv">min</span><span class="o">=</span><span class="m">372</span>.26ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">6</span>.89s<span class="w">    </span><span class="nv">max</span><span class="o">=</span><span class="m">37</span>.73s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">20</span>.51s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">25</span>.54s
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">     </span>http_req_failed................:<span class="w"> </span><span class="m">97</span>.03%<span class="w"> </span>✓<span class="w"> </span><span class="m">11276</span><span class="w">     </span>✗<span class="w"> </span><span class="m">345</span><span class="w">   </span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">     </span>http_req_receiving.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">2</span>.46µs<span class="w">   </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">max</span><span class="o">=</span><span class="m">532</span>.61µs<span class="w"> </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>0s<span class="w">    </span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">     </span>http_req_sending...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">229</span>.78µs<span class="w"> </span><span class="nv">min</span><span class="o">=</span><span class="m">10</span>.67µs<span class="w">  </span><span class="nv">med</span><span class="o">=</span><span class="m">59</span>.28µs<span class="w">  </span><span class="nv">max</span><span class="o">=</span><span class="m">11</span>.64ms<span class="w">  </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">408</span>.53µs<span class="w"> </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">1</span>.26ms
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">     </span>http_req_tls_handshaking.......:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">max</span><span class="o">=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>0s<span class="w">    </span>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">     </span>http_req_waiting...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">31</span>.44s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">372</span>.09ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">31</span>.69s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">58</span>.3s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">41</span>.86s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">46</span>.66s
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">     </span>http_reqs......................:<span class="w"> </span><span class="m">11621</span><span class="w">  </span><span class="m">91</span>.116311/s
<a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">     </span>iteration_duration.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">32</span>.78s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">1</span>.37s<span class="w">    </span><span class="nv">med</span><span class="o">=</span><span class="m">32</span>.84s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">59</span>.53s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">43</span>.03s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">47</span>.82s
<a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">     </span>iterations.....................:<span class="w"> </span><span class="m">11621</span><span class="w">  </span><span class="m">91</span>.116311/s
<a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">     </span>vus............................:<span class="w"> </span><span class="m">766</span><span class="w">    </span><span class="nv">min</span><span class="o">=</span><span class="m">41</span><span class="w">      </span><span class="nv">max</span><span class="o">=</span><span class="m">4994</span>
<a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">     </span>vus_max........................:<span class="w"> </span><span class="m">5000</span><span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">5000</span><span class="w">    </span><span class="nv">max</span><span class="o">=</span><span class="m">5000</span>
<a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>
<a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>
<a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a>running<span class="w"> </span><span class="o">(</span>2m07.5s<span class="o">)</span>,<span class="w"> </span><span class="m">0000</span>/5000<span class="w"> </span>VUs,<span class="w"> </span><span class="m">11621</span><span class="w"> </span><span class="nb">complete</span><span class="w"> </span>and<span class="w"> </span><span class="m">0</span><span class="w"> </span>interrupted<span class="w"> </span>iterations
<a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a>default<span class="w"> </span>✓<span class="w"> </span><span class="o">[======================================]</span><span class="w"> </span><span class="m">0000</span>/5000<span class="w"> </span>VUs<span class="w">  </span>1m45s
</code></pre></div>
<p>Resultado de Grafana:</p>
<p><img alt="CPU usage" src="../img/test3-cpu.png" />
<img alt="Network traffic" src="../img/test3-network.png" />
<img alt="Memory usage" src="../img/test3-memory.png" />
<img alt="Disk usage" src="../img/test3-disk-usage.png" /></p>
<h3 id="test-4-register-new-products">Test 4: Register new products</h3>
<p>Archivo de configuración de K6 utilizado:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6/http&#39;</span><span class="p">;</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">check</span><span class="p">,</span><span class="w"> </span><span class="nx">sleep</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6&#39;</span><span class="p">;</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">  </span><span class="nx">stages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;15s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;30s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">2500</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">5000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w">  </span><span class="p">],</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="p">};</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="c1">// Tokens para dos usuarios distintos</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="kd">const</span><span class="w"> </span><span class="nx">token1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFhZ3VzdGlubkBnbWFpbC5jb20iLCJleHAiOjE3MDI5MjgzOTd9.VveUVEFxY8E1fT20h-yUxEj46rAzZugdpTW1XpuksYU&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// aagustinn@gmail.com</span>
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">token2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFhZ3VzdGlubkBnbWFpbC5jb20iLCJleHAiOjE3MDI5MjgzOTd9.VveUVEFxY8E1fT20h-yUxEj46rAzZugdpTW1XpuksYU&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// aagustinn@gmail.com</span>
<a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a>
<a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="w">  </span><span class="c1">// Alternancia entre usuarios</span>
<a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__VU</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">token1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">token2</span><span class="p">;</span>
<a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a>
<a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="w">  </span><span class="c1">// Datos aleatorios para la creación de productos</span>
<a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">productCodeLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">8</span><span class="p">;</span><span class="w"> </span><span class="c1">// Entre 8 y 13 caracteres</span>
<a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">productCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">productCodeLength</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
<a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">productName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`product_</span><span class="si">${</span><span class="nx">productCode</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
<a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a>
<a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="w">  </span><span class="c1">// Realizar la solicitud POST para la creación de productos</span>
<a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://192.168.39.203:31000/product/add&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`{</span>
<a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a><span class="sb">    &quot;new_product&quot;: {</span>
<a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a><span class="sb">      &quot;product_code&quot;: &quot;</span><span class="si">${</span><span class="nx">productCode</span><span class="si">}</span><span class="sb">&quot;,</span>
<a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a><span class="sb">      &quot;name&quot;: &quot;</span><span class="si">${</span><span class="nx">productName</span><span class="si">}</span><span class="sb">&quot;,</span>
<a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a><span class="sb">      &quot;price&quot;: </span><span class="si">${</span><span class="nx">price</span><span class="si">}</span><span class="sb">,</span>
<a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a><span class="sb">      &quot;amount&quot;: </span><span class="si">${</span><span class="nx">amount</span><span class="si">}</span>
<a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a><span class="sb">    }</span>
<a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a><span class="sb">  }`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a><span class="w">      </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="w">      </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">userToken</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<a id="__codelineno-52-39" name="__codelineno-52-39" href="#__codelineno-52-39"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-52-40" name="__codelineno-52-40" href="#__codelineno-52-40"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-52-41" name="__codelineno-52-41" href="#__codelineno-52-41"></a>
<a id="__codelineno-52-42" name="__codelineno-52-42" href="#__codelineno-52-42"></a><span class="w">  </span><span class="c1">// Verificar si la respuesta es exitosa (código 2xx)</span>
<a id="__codelineno-52-43" name="__codelineno-52-43" href="#__codelineno-52-43"></a><span class="w">  </span><span class="nx">check</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-44" name="__codelineno-52-44" href="#__codelineno-52-44"></a><span class="w">    </span><span class="s1">&#39;status was 2xx&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">300</span><span class="p">,</span>
<a id="__codelineno-52-45" name="__codelineno-52-45" href="#__codelineno-52-45"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-52-46" name="__codelineno-52-46" href="#__codelineno-52-46"></a>
<a id="__codelineno-52-47" name="__codelineno-52-47" href="#__codelineno-52-47"></a><span class="w">  </span><span class="c1">// Introducir una pausa de 1 segundo entre las solicitudes</span>
<a id="__codelineno-52-48" name="__codelineno-52-48" href="#__codelineno-52-48"></a><span class="w">  </span><span class="nx">sleep</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-52-49" name="__codelineno-52-49" href="#__codelineno-52-49"></a><span class="p">}</span>
</code></pre></div>
<p>Resultado de consola de k6:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="w">     </span>✗<span class="w"> </span>status<span class="w"> </span>was<span class="w"> </span>2xx
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">      </span>↳<span class="w">  </span><span class="m">10</span>%<span class="w"> </span>—<span class="w"> </span>✓<span class="w"> </span><span class="m">1316</span><span class="w"> </span>/<span class="w"> </span>✗<span class="w"> </span><span class="m">10795</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">     </span>checks.........................:<span class="w"> </span><span class="m">10</span>.86%<span class="w"> </span>✓<span class="w"> </span><span class="m">1316</span><span class="w">      </span>✗<span class="w"> </span><span class="m">10795</span><span class="w"> </span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">     </span>data_received..................:<span class="w"> </span><span class="m">323</span><span class="w"> </span>kB<span class="w"> </span><span class="m">2</span>.4<span class="w"> </span>kB/s
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="w">     </span>data_sent......................:<span class="w"> </span><span class="m">5</span>.6<span class="w"> </span>MB<span class="w"> </span><span class="m">42</span><span class="w"> </span>kB/s
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="w">     </span>http_req_blocked...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">203</span>.4ms<span class="w">  </span><span class="nv">min</span><span class="o">=</span><span class="m">2</span>.42µs<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">755</span>.2µs<span class="w">  </span><span class="nv">max</span><span class="o">=</span><span class="m">1</span>.03s<span class="w">  </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">1</span>.02s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">1</span>.02s<span class="w">  </span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="w">     </span>http_req_connecting............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">203</span>.31ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">     </span><span class="nv">med</span><span class="o">=</span><span class="m">638</span>.59µs<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">1</span>.03s<span class="w">  </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">1</span>.02s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">1</span>.02s<span class="w">  </span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="w">     </span>http_req_duration..............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">30</span>.57s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">8</span>.11ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">30</span>.84s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">55</span>.6s<span class="w">  </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">47</span>.06s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">50</span>.89s<span class="w"> </span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">       </span><span class="o">{</span><span class="w"> </span>expected_response:true<span class="w"> </span><span class="o">}</span>...:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">1</span>.54s<span class="w">    </span><span class="nv">min</span><span class="o">=</span><span class="m">8</span>.11ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">287</span>.59ms<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">27</span>.99s<span class="w"> </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">1</span>.17s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">3</span>.11s<span class="w">  </span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="w">     </span>http_req_failed................:<span class="w"> </span><span class="m">89</span>.13%<span class="w"> </span>✓<span class="w"> </span><span class="m">10795</span><span class="w">     </span>✗<span class="w"> </span><span class="m">1316</span><span class="w">  </span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="w">     </span>http_req_receiving.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">11</span>.27µs<span class="w">  </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">     </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">max</span><span class="o">=</span><span class="m">5</span>.32ms<span class="w"> </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">49</span>.44µs<span class="w">  </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">74</span>.14µs
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">     </span>http_req_sending...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">105</span>.04µs<span class="w"> </span><span class="nv">min</span><span class="o">=</span><span class="m">10</span>.8µs<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">57</span>.93µs<span class="w">  </span><span class="nv">max</span><span class="o">=</span><span class="m">4</span>.71ms<span class="w"> </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">206</span>.62µs<span class="w"> </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">298</span>.7µs
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">     </span>http_req_tls_handshaking.......:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">     </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">max</span><span class="o">=</span>0s<span class="w">     </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>0s<span class="w">     </span>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="w">     </span>http_req_waiting...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">30</span>.57s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">8</span>.02ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">30</span>.84s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">55</span>.6s<span class="w">  </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">47</span>.06s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">50</span>.89s<span class="w"> </span>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="w">     </span>http_reqs......................:<span class="w"> </span><span class="m">12111</span><span class="w">  </span><span class="m">89</span>.698041/s
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="w">     </span>iteration_duration.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">31</span>.93s<span class="w">   </span><span class="nv">min</span><span class="o">=</span>1s<span class="w">     </span><span class="nv">med</span><span class="o">=</span><span class="m">32</span>.03s<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">57</span>.1s<span class="w">  </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">48</span>.34s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">52</span>.15s<span class="w"> </span>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="w">     </span>iterations.....................:<span class="w"> </span><span class="m">12111</span><span class="w">  </span><span class="m">89</span>.698041/s
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="w">     </span>vus............................:<span class="w"> </span><span class="m">94</span><span class="w">     </span><span class="nv">min</span><span class="o">=</span><span class="m">34</span><span class="w">      </span><span class="nv">max</span><span class="o">=</span><span class="m">4999</span>
<a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="w">     </span>vus_max........................:<span class="w"> </span><span class="m">5000</span><span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">5000</span><span class="w">    </span><span class="nv">max</span><span class="o">=</span><span class="m">5000</span>
<a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>
<a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a>
<a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a>running<span class="w"> </span><span class="o">(</span>2m15.0s<span class="o">)</span>,<span class="w"> </span><span class="m">0000</span>/5000<span class="w"> </span>VUs,<span class="w"> </span><span class="m">12111</span><span class="w"> </span><span class="nb">complete</span><span class="w"> </span>and<span class="w"> </span><span class="m">94</span><span class="w"> </span>interrupted<span class="w"> </span>iterations
<a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a>default<span class="w"> </span>✓<span class="w"> </span><span class="o">[======================================]</span><span class="w"> </span><span class="m">0060</span>/5000<span class="w"> </span>VUs<span class="w">  </span>1m45s
</code></pre></div>
<p>Resultado de Grafana:</p>
<p><img alt="CPU usage" src="../img/test4-cpu.png" />
<img alt="Network traffic" src="../img/test4-network.png" />
<img alt="Memory usage" src="../img/test4-memory.png" />
<img alt="Disk usage" src="../img/test4-disk-usage.png" /></p>
<h3 id="test-5-get-images">Test 5: Get images</h3>
<p>Archivo de configuración de K6 utilizado:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6/http&#39;</span><span class="p">;</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">check</span><span class="p">,</span><span class="w"> </span><span class="nx">sleep</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;k6&#39;</span><span class="p">;</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">  </span><span class="nx">stages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;15s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;30s&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">2500</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">duration</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="o">:</span><span class="w"> </span><span class="mf">5000</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="w">  </span><span class="p">],</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="p">};</span>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="w">  </span><span class="c1">// Proporcionar una lista de IDs de las imágenes</span>
<a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">imageIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="w">    </span><span class="s1">&#39;57d2adf1-8062-4908-a73f-02f4c9320d35&#39;</span><span class="p">,</span>
<a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="w">    </span><span class="s1">&#39;23598a4e-2d32-4b3a-b55e-00773c8cbe46&#39;</span><span class="p">,</span>
<a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a><span class="w">  </span><span class="p">];</span>
<a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a>
<a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="w">  </span><span class="c1">// Realizar solicitudes GET para obtener imágenes</span>
<a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a><span class="w">  </span><span class="nx">imageIds</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">imageId</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="sb">`http://192.168.39.203:31000/image/get/?id=</span><span class="si">${</span><span class="nx">imageId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a><span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="w">        </span><span class="s1">&#39;Accept&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a><span class="w">      </span><span class="p">},</span>
<a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a>
<a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a><span class="w">    </span><span class="c1">// Verificar si la respuesta es exitosa (código 2xx)</span>
<a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a><span class="w">    </span><span class="nx">check</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a><span class="w">      </span><span class="s1">&#39;status was 2xx&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">300</span><span class="p">,</span>
<a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a>
<a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a><span class="w">    </span><span class="c1">// Introducir una pausa de 1 segundo entre las solicitudes</span>
<a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a><span class="w">    </span><span class="nx">sleep</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a><span class="p">}</span>
</code></pre></div>
<p>Resultado de consola de k6:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="w">     </span>✗<span class="w"> </span>status<span class="w"> </span>was<span class="w"> </span>2xx
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">      </span>↳<span class="w">  </span><span class="m">0</span>%<span class="w"> </span>—<span class="w"> </span>✓<span class="w"> </span><span class="m">46</span><span class="w"> </span>/<span class="w"> </span>✗<span class="w"> </span><span class="m">12242</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">     </span>checks.........................:<span class="w"> </span><span class="m">0</span>.37%<span class="w">  </span>✓<span class="w"> </span><span class="m">46</span><span class="w">        </span>✗<span class="w"> </span><span class="m">12242</span><span class="w"> </span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">     </span>data_received..................:<span class="w"> </span><span class="m">2</span>.2<span class="w"> </span>MB<span class="w"> </span><span class="m">16</span><span class="w"> </span>kB/s
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">     </span>data_sent......................:<span class="w"> </span><span class="m">2</span>.2<span class="w"> </span>MB<span class="w"> </span><span class="m">17</span><span class="w"> </span>kB/s
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">     </span>http_req_blocked...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">781</span>.12ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span><span class="m">4</span>.71µs<span class="w">  </span><span class="nv">med</span><span class="o">=</span><span class="m">1</span>.15ms<span class="w">   </span><span class="nv">max</span><span class="o">=</span><span class="m">7</span>.24s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">3</span>.03s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">3</span>.06s<span class="w">   </span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">     </span>http_req_connecting............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">780</span>.93ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">      </span><span class="nv">med</span><span class="o">=</span><span class="m">991</span>.98µs<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">7</span>.24s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">3</span>.03s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">3</span>.06s<span class="w">   </span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">     </span>http_req_duration..............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">30</span>.27s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">73</span>.76ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">30</span>.33s<span class="w">   </span><span class="nv">max</span><span class="o">=</span>1m0s<span class="w">     </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">48</span>.87s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">54</span>.06s<span class="w">  </span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">       </span><span class="o">{</span><span class="w"> </span>expected_response:true<span class="w"> </span><span class="o">}</span>...:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">419</span>.68ms<span class="w"> </span><span class="nv">min</span><span class="o">=</span><span class="m">73</span>.76ms<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">414</span>.18ms<span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">800</span>.17ms<span class="w"> </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">684</span>.03ms<span class="w"> </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">763</span>.76ms
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">     </span>http_req_failed................:<span class="w"> </span><span class="m">99</span>.62%<span class="w"> </span>✓<span class="w"> </span><span class="m">12242</span><span class="w">     </span>✗<span class="w"> </span><span class="m">46</span><span class="w">    </span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">     </span>http_req_receiving.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">254</span>.2ms<span class="w">  </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">      </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">max</span><span class="o">=</span><span class="m">30</span>.77s<span class="w">   </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>0s<span class="w">      </span>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="w">     </span>http_req_sending...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">74</span>.72ms<span class="w">  </span><span class="nv">min</span><span class="o">=</span><span class="m">11</span>.36µs<span class="w"> </span><span class="nv">med</span><span class="o">=</span><span class="m">97</span>.25µs<span class="w">  </span><span class="nv">max</span><span class="o">=</span><span class="m">26</span>.8s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">704</span>.63µs<span class="w"> </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">1</span>.56ms<span class="w">  </span>
<a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="w">     </span>http_req_tls_handshaking.......:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">min</span><span class="o">=</span>0s<span class="w">      </span><span class="nv">med</span><span class="o">=</span>0s<span class="w">       </span><span class="nv">max</span><span class="o">=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>0s<span class="w">       </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>0s<span class="w">      </span>
<a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="w">     </span>http_req_waiting...............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span><span class="m">29</span>.95s<span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">6</span>.22ms<span class="w">  </span><span class="nv">med</span><span class="o">=</span><span class="m">30</span>.33s<span class="w">   </span><span class="nv">max</span><span class="o">=</span>1m0s<span class="w">     </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span><span class="m">48</span>.55s<span class="w">   </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span><span class="m">53</span>.75s<span class="w">  </span>
<a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="w">     </span>http_reqs......................:<span class="w"> </span><span class="m">12288</span><span class="w">  </span><span class="m">90</span>.987543/s
<a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="w">     </span>iteration_duration.............:<span class="w"> </span><span class="nv">avg</span><span class="o">=</span>1m4s<span class="w">     </span><span class="nv">min</span><span class="o">=</span><span class="m">26</span>.73s<span class="w">  </span><span class="nv">med</span><span class="o">=</span>1m7s<span class="w">     </span><span class="nv">max</span><span class="o">=</span>1m35s<span class="w">    </span>p<span class="o">(</span><span class="m">90</span><span class="o">)=</span>1m28s<span class="w">    </span>p<span class="o">(</span><span class="m">95</span><span class="o">)=</span>1m30s<span class="w">   </span>
<a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a><span class="w">     </span>iterations.....................:<span class="w"> </span><span class="m">5423</span><span class="w">   </span><span class="m">40</span>.155065/s
<a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a><span class="w">     </span>vus............................:<span class="w"> </span><span class="m">1442</span><span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">42</span><span class="w">      </span><span class="nv">max</span><span class="o">=</span><span class="m">4999</span>
<a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a><span class="w">     </span>vus_max........................:<span class="w"> </span><span class="m">5000</span><span class="w">   </span><span class="nv">min</span><span class="o">=</span><span class="m">5000</span><span class="w">    </span><span class="nv">max</span><span class="o">=</span><span class="m">5000</span>
<a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a>
<a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a>
<a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a>running<span class="w"> </span><span class="o">(</span>2m15.1s<span class="o">)</span>,<span class="w"> </span><span class="m">0000</span>/5000<span class="w"> </span>VUs,<span class="w"> </span><span class="m">5423</span><span class="w"> </span><span class="nb">complete</span><span class="w"> </span>and<span class="w"> </span><span class="m">1442</span><span class="w"> </span>interrupted<span class="w"> </span>iterations
<a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a>default<span class="w"> </span>✓<span class="w"> </span><span class="o">[======================================]</span><span class="w"> </span><span class="m">1432</span>/5000<span class="w"> </span>VUs<span class="w">  </span>1m45s
</code></pre></div>
<p>Resultado de Grafana:</p>
<p><img alt="CPU usage" src="../img/test5-cpu.png" />
<img alt="Network traffic" src="../img/test5-network.png" />
<img alt="Memory usage" src="../img/test5-memory.png" />
<img alt="Disk usage" src="../img/test5-disk-usage.png" /></p>
<h2 id="conclusiones-de-las-pruebas-realizadas">Conclusiones de las pruebas realizadas</h2>
<p>En términos generales, hemos logrado cumplir con los requisitos establecidos por la empresa, confirmando que la plataforma es capaz de soportar hasta 5000 usuarios en su página de inicio, aunque esta evaluación consideró un número limitado de productos al inicio de la prueba. No obstante, las pruebas adicionales revelaron limitaciones notables, principalmente relacionadas con la capacidad del disco tanto en términos de la cantidad de productos y usuarios que podemos agregar como en su rendimiento de lectura/escritura, siendo este un factor determinante en las operaciones que involucran la base de datos.</p>
<p>En todas las instancias en las que la base de datos estuvo involucrada, como la creación de nuevos productos y usuarios, el rendimiento del disco se destacó como el factor crítico. Observamos que las pruebas centradas en usuarios afectaron más al CPU, especialmente cuando la API tuvo que encriptar o desencriptar contraseñas. A lo largo de todas las pruebas, la memoria mostró una estabilidad notable, mientras que la red experimentó una mayor actividad durante las transmisiones y recepciones de información en las solicitudes a la API.</p>
<p>Como conclusión, consideramos que el sistema es fiable para el uso actual de la empresa. Sin embargo, en caso de requerir una mayor creación de usuarios o un mayor número de solicitudes, se sugiere la implementación de un Ingress Controller y un balanceador de carga, junto con el escalado de los Deployments de la UI, la API y la DB. En particular, para la base de datos, se recomienda configurarla como un ReplicaSet para optimizar su rendimiento.</p>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 <a href="https://www.ing.unrc.edu.ar/inicio.php"  target="_blank" rel="noopener">Universidad Nacional de Río cuarto | Facultad de Ingeniería</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/aagustinconti/testing_apps_tcpip" target="_blank" rel="noopener" title="Repo URL" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>